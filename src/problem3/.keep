interface WalletBalance {
    currency: string;
    amount: number;

    // FIX: Added missing blockchain field (was used but not defined)
    blockchain: Blockchain;
}

interface FormattedWalletBalance {
    currency: string;
    amount: number;
    formatted: string;
}

interface Props extends BoxProps { }

// FIX: Replaced `any` with strict union type for type safety
type Blockchain =
    | 'Osmosis'
    | 'Ethereum'
    | 'Arbitrum'
    | 'Zilliqa'
    | 'Neo';

// FIX: Replaced switch-case with lookup map (cleaner & more performant)
const PRIORITY_MAP: Record<Blockchain, number> = {
    Osmosis: 100,
    Ethereum: 50,
    Arbitrum: 30,
    Zilliqa: 20,
    Neo: 20,
};

const WalletPage: React.FC<Props> = (props: Props) => {
    const { children, ...rest } = props;
    const balances = useWalletBalances();
    const prices = usePrices();

    // REMOVED: getPriority function (replaced by PRIORITY_MAP)

    const sortedBalances = useMemo(() => {
        return balances
            .filter((balance: WalletBalance) => {

                // FIX: Removed undefined variable `lhsPriority`
                // FIX: Corrected filter logic (previous code kept zero balances)

                const balancePriority = PRIORITY_MAP[balance.blockchain];

                return balancePriority > -99 && balance.amount > 0;
            })
            .sort((lhs: WalletBalance, rhs: WalletBalance) => {
                const leftPriority = PRIORITY_MAP[lhs.blockchain];
                const rightPriority = PRIORITY_MAP[rhs.blockchain];

                // FIX: Simplified comparator & ensured full return value
                return rightPriority - leftPriority;
            });

        // FIX: Removed `prices` from dependency array (not used here)
    }, [balances]);

    // REMOVED: formattedBalances (was redundant, caused double iteration)

    const rows = sortedBalances.map((balance: WalletBalance) => {

        // FIX: Added safe fallback to prevent NaN if price undefined
        const usdValue =
            (prices[balance.currency] ?? 0) * balance.amount;

        return (
            <WalletRow
                className={classes.row}

                // FIX: Replaced index key with stable composite key
                key={`${balance.blockchain}-${balance.currency}`}

                amount={balance.amount}
                usdValue={usdValue}

                // FIX: Formatting directly here (removed extra map)
                formattedAmount={balance.amount.toFixed(2)}
            />
        );
    });

    return (
        <div {...rest}>
            {rows}
        </div>
    );
};
